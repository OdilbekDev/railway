{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>WESTER SCHOOL</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{% static 'vendors/ti-icons/css/themify-icons.css' %}">
  <link rel="stylesheet" href="{% static 'vendors/base/vendor.bundle.base.css' %}">
  <!-- endinject -->
  <!-- plugin css for this page -->
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <!-- endinject -->
  <link rel="shortcut icon" href="{% static 'images/favicon.png' %}" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
</head>
<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand" href="{% url 'hisobot' %}"><img style="object-fit: contain; width: 60px; height: 80px;" src="{% static 'images/logo.png' %}" class="mr-2" alt="logo"/></a>
        <p style="font-family: 'Noto Sans'; color: black; background-color: yellow;">WESTER SCHOOL</p>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="ti-view-list"></span>
        </button>
        <ul class="navbar-nav mr-lg-2">
        </ul>
        <ul class="navbar-nav navbar-nav-right" style="display: flex; align-items: center; flex-direction: column !important;">
          <button class="navbar-toggler"><a href="{% url 'logout' %}"><i id="logout" class="bi bi-box-arrow-left"></i></a></button>
          <span>Log out</span>
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
          <span class="ti-view-list"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'hisobot' %}">
              <i class="ti-info-alt menu-icon"></i>
              <span class="menu-title">Hisobot</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'workers' %}">
              <i class="ti-user menu-icon"></i>
              <span class="menu-title">Ishchilar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'groups' %}">
              <i class="ti-view-list-alt menu-icon"></i>
              <span class="menu-title">Guruhlar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href={% url 'pupils_all' %}>
              <i class="ti-user menu-icon"></i>
              <span class="menu-title">O'quvchilar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'teachers' %}">
              <i class="ti-star menu-icon"></i>
              <span class="menu-title">O'qituvchilar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'payments-all' %}">
              <i class="ti-money menu-icon"></i>
              <span class="menu-title">To'lovlar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'parents' %}">
              <i class="ti-view-list-alt menu-icon"></i>
              <span class="menu-title">Ota-onalar</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'time-tables' %}">
              <i class="ti-view-list-alt menu-icon"></i>
              <span class="menu-title">Dars jadvallari</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'debtors' %}">
              <i class="ti-view-list-alt menu-icon"></i>
              <span class="menu-title">Qarzdorlar ro'yhati</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'waiting-pupils' %}">
              <i class="ti-view-list-alt menu-icon"></i>
              <span class="menu-title">Kutayotgan o'quvchilar ro'yhati</span>
            </a>
          </li>
        </ul>
      </nav>
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="row">
            <div class="col-md-12 grid-margin">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h4 class="font-weight-bold mb-0">Wester Schoolning statistikalari</h4>
                </div>
                <div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-3 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title text-md-center text-xl-left">To'lovlar</p>
                  <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                    <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{payments}}</h3>
                    <i class="ti-calendar icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                  </div>  
                  <p class="mb-0 mt-2 text-danger">{{payments_today}} ta<span class="text-black ml-1"><small>(kunlik)</small></span></p>
                  {% if debtors_count > 0 %}
                    <p class="mb-0 mt-2 text-warning">{{debtors_count}} ta<span class="text-black ml-1"><small>(Qarzdorlar soni)</small></span></p>
                  {% else %}
                  <p class="mb-0 mt-2 text-success">{{debtors_count}} ta<span class="text-black ml-1"><small>(Qarzdorlar soni)</small></span></p>
                  {% endif %}
                  <p class="mb-0 mt-2 text-success">{{debtors_total_money}} so'm<span class="text-black ml-1"><small>(Qarzdorlar summasi)</small></span></p>
                </div>
              </div>
            </div>
            <div class="col-md-3 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title text-md-center text-xl-left">O'quvchilar</p>
                  <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                    <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{pupils}}</h3>
                    <i class="ti-user icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                  </div>
                  <p class="mb-0 mt-2 text-danger">{{pupils_today}} ta<span class="text-black ml-1"><small>(kunlik)</small></span></p>
                  <p class="mb-0 mt-2 text-danger">{{waiting_students}} ta<span class="text-black ml-1"><small>(kutayotganlar)</small></span></p>
                </div>
              </div>
            </div>
            <div class="col-md-3 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title text-md-center text-xl-left">O'qituvchilar</p>
                  <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                    <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{teachers}}</h3>
                    <i class="ti-agenda icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                  </div>  
                </div>
              </div>
            </div>
            <div class="col-md-3 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title text-md-center text-xl-left">Tark etgan o'quvchilar</p>
                  <div class="d-flex flex-wrap justify-content-between justify-content-md-center justify-content-xl-between align-items-center">
                    <h3 class="mb-0 mb-md-2 mb-xl-0 order-md-1 order-xl-0">{{leaved_students}}</h3>
                    <i class="ti-na icon-md text-muted mb-0 mb-md-3 mb-xl-0"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12 grid-margin stretch-card" >
              <div class="card border-bottom-0">
                <div class="card-body pb-0" style="display: flex; flex-direction: column;">
                  <p class="card-title">Faollik</p>
                  <p class="text-muted font-weight-light">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Minima suscipit ratione architecto quo. Voluptatem, fugiat animi. Nihil fugit quo consequuntur blanditiis temporibus voluptatum, ducimus pariatur perspiciatis dignissimos fuga quis vel perferendis officiis enim nostrum aut maiores repellendus placeat, consequatur nemo, similique neque. Inventore illo dicta cumque possimus est ab animi.</p>
                  <div class="d-flex flex-wrap mb-5" style="justify-content: space-between;">
                    <div class="mr-5 mt-3">
                      <p class="text-muted" style="font-size: 20px;">Faol studentlar</p>
                      <h3>{{pupils_educating}}</h3>
                    </div>
                    <div class="mr-5 mt-3">
                      <p class="text-muted" style="font-size: 20px;">Guruhlar</p>
                      <h3>{{group}}</h3>
                    </div>
                    <div class="mr-5 mt-3">
                      <p class="text-muted" style="font-size: 20px;">Ota-onalar</p>
                      <h3>{{parents}}</h3>
                    </div>
                    <div class="mt-3">
                      <p class="text-muted" style="font-size: 20px;">Byudjet</p>
                      <h3>{{total_balance}} so'm </h3>
                    </div>
                    <div class="mt-3 ml-3">
                      <p class="text-muted" style="font-size: 20px;">Harajat</p>
                      <h3>{{outgoing_balance}} so'm</h3>
                    </div>
                  </div>
                </div>
                <canvas id="order-chart" class="w-100"></canvas>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-7 grid-margin stretch-card">
              <div class="card">
                <div class="card-body">
                  <p class="card-title mb-0">Top Studentlar</p>
                  <div class="table-responsive">
                    <table class="table table-hover">
                      <thead>
                        <tr>
                          <th>Student</th>
                          <th>Guruh</th>
                          <th>To'lov</th>
                          <th>Status</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for i in top_student %}
                          <tr>
                            <td>{{i.name}}</td>
                            <td>{{i.group.name}}</td>
                            <td class="text-danger">{{balance__payment}}<i class="ti-arrow-down"></i></td>
                            {% if i.status == 2 %}
                            <td><label class="badge badge-danger">O'qimoqda</label></td>
                            {% endif %}
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-5 grid-margin stretch-card">
							<div class="card">
								<div class="card-body">
									<h4 class="card-title">Topshiriqlar qo'shish</h4>
                  <div class="add-items  mb-0 mt-4">
                    <form class="d-flex" action="{% url 'add-task' %}" method="post">
                      {% csrf_token %}
										  <input name="title" type="text" class="form-control todo-list-input mr-2"  placeholder="Add new task">
                      <select name="branch" class="form-select">
                        {% for i in branch %}
                          <option value="{{i.id}}">{{i.name}}</option>
                        {% endfor %}
                      </select>
										  <button type="submit" class="btn btn-icon text-primary bg-transparent"><i class="ti-location-arrow"></i></button>
                    </form>
                    </div>
								</div>
							</div>
            </div>
          </div>
          <div class="container">
            <div class="row my-3">
                <div class="row">
                  <h4>To'lovlar diagnostikasi</h4>
                </div>
            </div>
            <div class="row my-2">
                <div class="col-md-6 py-1">
                    <div class="card">
                        <div class="card-body">
                            <canvas id="chLine"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 py-1">
                    <div class="card">
                        <div class="card-body">
                          <h4>O'quvchilar hisoboti</h4>
                            <canvas id="chBar"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row py-2">
                <div class="col-md-4 py-1">
                    <div class="card">
                        <div class="card-body">
                          <h4 style="font-style: italic;">O'quvchilar (haftalik)</h4>
                          <canvas id="chDonut1"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 py-1">
                    <div class="card">
                        <div class="card-body">
                          <h4 style="font-style: italic;">O'quvchilar (oylik)</h4>
                            <canvas id="chDonut2"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 py-1">
                    <div class="card">
                        <div class="card-body">
                            <canvas id="chDonut3"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2023 </span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->

  <!-- plugins:js -->
  <script src="{% static 'vendors/base/vendor.bundle.base.js' %}"></script>
  <script src="{% static 'vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{% static 'js/off-canvas.js' %}"></script>
  <script src="{% static 'js/hoverable-collapse.js' %}"></script>
  <script src="{% static 'js/template.js' %}"></script>
  <script src="{% static 'js/todolist.js' %}"></script>
  <script src="{% static 'js/dashboard.js' %}"></script>
  <script>
    /* chart.js chart examples */

// chart colors
var colors = ['#007bff','#28a745','#dc3545','#c3e6cb','#dc3545','#6c757d'];

/* large line chart */
var chLine = document.getElementById("chLine");
var chartData = {
  labels: ["{{six_days_ago_weekday}}", "{{five_days_ago_weekday}}", "{{four_days_ago_weekday}}", "{{three_days_ago_weekday}}", "{{before_yesterday_weekday}}", "{{yesterday_weekday}}", "{{today_weekday}}"],
  datasets: [{
    data: [0, '{{five_days_ago_payments_numbers}}', '{{four_days_ago_payments_numbers}}', '{{three_days_ago_payments_numbers}}', '{{before_yesterday_payments_numbers}}', '{{yesterday_payments_numbers}}', '{{daily_payments_numbers}}'],
    backgroundColor: 'transparent',
    borderColor: colors[0],
    borderWidth: 4,
    pointBackgroundColor: colors[0]
  }
//   {
//     data: [639, 465, 493, 478, 589, 632, 674],
//     backgroundColor: colors[3],
//     borderColor: colors[1],
//     borderWidth: 4,
//     pointBackgroundColor: colors[1]
//   }
  ]
};
if (chLine) {
  new Chart(chLine, {
  type: 'line',
  data: chartData,
  options: {
    scales: {
      xAxes: [{
        ticks: {
          beginAtZero: false
        }
      }]
    },
    legend: {
      display: false
    },
    responsive: true
  }
  });
}

/* large pie/donut chart */
var chPie = document.getElementById("chPie");
if (chPie) {
  new Chart(chPie, {
    type: 'pie',
    data: {
      labels: ['Desktop', 'Phone', 'Tablet', 'Unknown'],
      datasets: [
        {
          backgroundColor: [colors[1],colors[0],colors[2],colors[5]],
          borderWidth: 0,
          data: [50, 40, 15, 5]
        }
      ]
    },
    plugins: [{
      beforeDraw: function(chart) {
        var width = chart.chart.width,
            height = chart.chart.height,
            ctx = chart.chart.ctx;
        ctx.restore();
        var fontSize = (height / 70).toFixed(2);
        ctx.font = fontSize + "em sans-serif";
        ctx.textBaseline = "middle";
        var text = chart.config.data.datasets[0].data[0] + "%",
            textX = Math.round((width - ctx.measureText(text).width) / 2),
            textY = height / 2;
        ctx.fillText(text, textX, textY);
        ctx.save();
      }
    }],
    options: {layout:{padding:0}, legend:{display:false}, cutoutPercentage: 80}
  });
}

/* bar chart */
var chBar = document.getElementById("chBar");
if (chBar) {
  new Chart(chBar, {
  type: 'bar',
  data: {
    labels: ["Qabul", "Davomat +", "Qarzdorlar"],
    datasets: [{
      data: ["{{pupils_yesterday_accepted}}", "{{lessons_yesterday}}", "{{debtors_count}}"],
      backgroundColor: colors[0]
    },
    {
      data: ["{{pupils_today_accepted}}", "{{lessons_today}}", "{{pupils}}"],
      backgroundColor: colors[1]
    }]
  },
  options: {
    legend: {
      display: false
    },
    scales: {
      xAxes: [{
        barPercentage: 0.4,
        categoryPercentage: 0.5
      }]
    }
  }
  });
}

/* 3 donut charts */
var donutOptions = {
  cutoutPercentage: 85, 
  legend: {position:'bottom', padding:5, labels: {pointStyle:'circle', usePointStyle:true}}
};

// donut 1
var chDonutData1 = {
    labels: ["Qabul", 'Qoshilgan', 'Tark etgan', 'Yonaltirilgan tolov'],
    datasets: [
      {
        backgroundColor: colors.slice(0,3),
        borderWidth: 0,
        data: ["{{weekly_pupils_numbers}}", "{{weekly_pupils2}}", "{{weekly_pupils3}}", "{{pupils_paid_all}}"]
      }
    ]
};

var chDonut1 = document.getElementById("chDonut1");
if (chDonut1) {
  new Chart(chDonut1, {
      type: 'pie',
      data: chDonutData1,
      options: donutOptions
  });
}

// donut 2
var chDonutData2 = {
    labels: ['Wips', 'Pops', 'Dags'],
    datasets: [
      {
        backgroundColor: colors.slice(0,3),
        borderWidth: 0,
        data: [40, 45, 30]
      }
    ]
};
var chDonut2 = document.getElementById("chDonut2");
if (chDonut2) {
  new Chart(chDonut2, {
      type: 'pie',
      data: chDonutData2,
      options: donutOptions
  });
}

// donut 3
var chDonutData3 = {
    labels: ['Angular', 'React', 'Other'],
    datasets: [
      {
        backgroundColor: colors.slice(0,3),
        borderWidth: 0,
        data: [21, 45, 55, 33]
      }
    ]
};
var chDonut3 = document.getElementById("chDonut3");
if (chDonut3) {
  new Chart(chDonut3, {
      type: 'pie',
      data: chDonutData3,
      options: donutOptions
  });
}

/* 3 line charts */
var lineOptions = {
    legend:{display:false},
    tooltips:{interest:false,bodyFontSize:11,titleFontSize:11},
    scales:{
        xAxes:[
            {
                ticks:{
                    display:false
                },
                gridLines: {
                    display:false,
                    drawBorder:false
                }
            }
        ],
        yAxes:[{display:false}]
    },
    layout: {
        padding: {
            left: 6,
            right: 6,
            top: 4,
            bottom: 6
        }
    }
};

var chLine1 = document.getElementById("chLine1");
if (chLine1) {
  new Chart(chLine1, {
      type: 'line',
      data: {
          labels: ['Jan','Feb','Mar','Apr','May'],
          datasets: [
            {
              backgroundColor:'#ffffff',
              borderColor:'#ffffff',
              data: [10, 11, 4, 11, 4],
              fill: false
            }
          ]
      },
      options: lineOptions
  });
}
var chLine2 = document.getElementById("chLine2");
if (chLine2) {
  new Chart(chLine2, {
      type: 'line',
      data: {
          labels: ['A','B','C','D','E'],
          datasets: [
            {
              backgroundColor:'#ffffff',
              borderColor:'#ffffff',
              data: [4, 5, 7, 13, 12],
              fill: false
            }
          ]
      },
      options: lineOptions
  });
}

var chLine3 = document.getElementById("chLine3");
if (chLine3) {
  new Chart(chLine3, {
      type: 'line',
      data: {
          labels: ['Pos','Neg','Nue','Other','Unknown'],
          datasets: [
            {
              backgroundColor:'#ffffff',
              borderColor:'#ffffff',
              data: [13, 15, 10, 9, 14],
              fill: false
            }
          ]
      },
      options: lineOptions
  });
}
  </script>
</body>

</html>

